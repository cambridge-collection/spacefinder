<div class="space">
    <div class="title">
        <a href="#" class="close-view">Close</a>
        <h1>#{name}</h1>
        <small>#{distance}les away</small>
    </div>
    <div class="gallery-container">
        <div class="gallery">
            <div class="gallery-images">
                #{images[<div style="background-image:url(#{value})" class="image"></div>]}
            </div>

        </div>
        <div class="tags">
            #{tags[<span class="tag #{attr}">#{value}</span>]}
        </div>
    </div>

    <div class="tabs">
        <ul>
            <li><a href="#info">Info</a></li>
            <li><a href="#tips">Tips</a></li>
            <li><a href="#map-#{id}">Map</a></li>
        </ul>
        <div id="info">
            <p>#{description}</p>
            <ul>
                <li>#{address}</li>
                <li>#{hours}</li>
            </ul>
            <ul>
                #{facilities[<li class="facility #{attr}">#{value}</li>]}
            </ul>
            <ul>
                #{atmosphere[<li class="atmosphere #{attr}">#{value}</li>]}
            </ul>
            <ul>
                #{tags[<li class="#{attr}">#{value}</li>]}
            </ul>
            <p>#{description}</p>
            <ul>
                <li>#{address}</li>
                <li>#{hours}</li>
            </ul>
            <ul>
                #{facilities[<li class="facility #{attr}">#{value}</li>]}
            </ul>
            <ul>
                #{atmosphere[<li class="atmosphere #{attr}">#{value}</li>]}
            </ul>
            <ul>
                #{tags[<li class="#{attr}">#{value}</li>]}
            </ul>
        </div>
        <div id="tips">
            tips screen
        </div>
        <div class="map" id="map-#{id}"></div>
    </div>
</div>
<script type="text/javascript">

var $space = $('#space-#{id}');
//stick headers
setTimeout(function () {
    $space.find('.tabs>ul').sticky({topSpacing:$space.find('.title').outerHeight()});
}, 500);
//close button
$space.find('.close-view').on('click', function(event) {
    event.preventDefault();
    if(oldView !== undefined) {
        window.location.hash = oldView;
    } else {
        window.location.hash = '/';
    }

});
//set up gallery
$space.find('.gallery>.gallery-images').width(($space.find('.gallery .image').length * 100) + '%')
//set up tabs
$space.find('.tabs').tabs({
    activate: function(e, ui) {
        console.log($(ui.newPanel).attr('id'));
        if($(ui.newPanel).attr('id') == "map-#{id}") {
            google.maps.event.trigger(localMap, 'resize');
            localMap.setCenter(m.getPosition());
        }
    }
});

//set up map

spaceMapOptions = {
    center: {'lat':#{latitude}, 'lng':#{longitude}},
    zoom: 18,
    disableDefaultUI: true
}

localMap = new google.maps.Map(document.getElementById('map-#{id}'), spaceMapOptions);

var m;
google.maps.event.trigger(localMap, 'resize');
console.log(localMap);
m = new google.maps.Marker({
    position: {'lat':#{latitude}, 'lng':#{longitude}},
    title:'#{name}',
    map:localMap,
    icon:markerSymbol
});
m.icon.fillColor = '#d6083b';
m.icon.fillOpacity = 1;
localMap.setCenter(m.getPosition());

</script>
