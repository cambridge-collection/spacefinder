function resize(e){systemEvent=!0,e.preventDefault(),currWidth=$(window).width(),$("div[id^=space-]").width($list.width()).css("left",$list.offset().left),1e3>currWidth&&"small"!==currView?(resizeForMobile(),$(window).trigger("layout")):currWidth>1e3&&"large"!==currView&&(resizeForDesktop(),$(window).trigger("layout")),void 0!==map&&0==openPoints.length&&(centerOnLocation?map.setCenter(userLoc):map.setCenter(loc));var t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g);null!==t&&"large"==currView&&$(".view-container").each(function(){var e=$(this)})}function resizeForMobile(){currView="small",$("body").removeClass("large_view"),$("#top-bar").find('a[href!="#/search"]').show(0),$("#search-btn").removeClass("active"),$("div[id^=space-]").css({left:0,top:0,width:"100%"})}function resizeForDesktop(){currView="large",$("body").addClass("large_view"),$("#top-bar").find('> a[href!="#/search"]').hide(0),$("#map").show(0),$("#search-btn").addClass("active"),$("#search").show(),$("div[id^=space-]").css({left:$list.offset().left,top:0,width:$list.width()})}function switchView(e,t){if("/list"==oldView&&(listScroll=Number($(window).scrollTop())),void 0==e&&(e=initialView),closeSpaces(),"small"==currView&&$(".view-container").css("position",""),-1==e.indexOf("/")&&$("#"+e).length>0)"small"==currView&&(console.log(e),$(".view-container").css("display","none"),$("a").removeClass("active"),$('a[href="#/'+e+'"]').addClass("active"),$("#"+e).fadeIn({duration:300,start:function(){"map"==e&&(google.maps.event.trigger(map,"resize"),$(window).scrollTop(0)),mapViewed||(systemEvent=!0,centerOnLocation?map.setCenter(userLoc):map.setCenter(loc))},progress:function(){"list"==e&&(systemEvent=!0,$(window).scrollTop(listScroll),map.setZoom(currentZoom),pointsInView()),"map"==e&&openPoints.length>0&&(systemEvent=!0,new google.maps.event.trigger(points[openPoints[0]].marker,"click"),systemEvent=!0,map.setZoom(currentZoom),pointsInView())}}));else if(-1!==e.indexOf("space")){"small"==currView&&$(".view-container").css("position","fixed");var n=e.split("/");loadSpace({id:n[1],name:n[2].replace("-"," ")})}$(".loading-cover").length>0&&$("html").hasClass("flexbox")?($(".loading-cover").addClass("loaded"),window.setTimeout(function(){$(".loading-cover").remove()},500)):($(".loading-cover").html('<p>It appears you are using an outdated browser. If possible switch to a newer one as some things may not look as they should or are missing. To continue into the app please click below</p><p><a href="#" id="old-continue">Continue</a></p>'),$("#old-continue").on("click",function(e){e.preventDefault(),$(".loading-cover").addClass("loaded").fadeOut(300,function(){$(this).remove()})})),pointsInView()}function loadSpace(e){var t={},n;$.extend(t,e),n=findMarkers(points,{id:t.id}).spaces,1==n.length?showSpace(n[0]):0==n.length&&$.ajax({url:"/assets/data/unloaded-space.json",dataType:"json",data:{id:t.id}}).done(function(e){"array"==$.type(e)&&(e=e[0]),showSpace(e)})}function showSpace(e){var t=$("<div />").css({"margin-top":$(window).height()}).attr("id","space-"+e.id).addClass("space-container").append(parseTemplate("spaceDetail",e)).insertAfter("#list");"large"==currView?(t.width($list.width()).css("left",$list.offset().left),t.animate({"margin-top":$("#top-bar").outerHeight(!0)},300)):t.animate({"margin-top":0},300,function(){t.find(".title").css("position","fixed"),t.css("overflow","auto")})}function closeSpaces(){var e=$("div[id^=space-]");if(e.css("overflow","hidden").find(".title").removeAttr("style"),$("div[id^=space-]").animate({"margin-top":$(window).height()},300,function(){$(this).remove(),"large"==currView&&$("#list").css("display","block")}),openPoints.length>0)for(var t=0;t<openPoints.length;t++)void 0!==points[openPoints[t]].mapSummary&&points[openPoints[t]].mapSummary.close(),points[openPoints[t]].marker.icon.fillColor=inactiveColor,points[openPoints[t]].marker.setZIndex(0),points[openPoints[t]].marker.setMap(map),openPoints.splice(t,1);systemEvent=!0,map.setZoom(currentZoom),systemEvent=!0,map.setCenter(currentLoc)}function resetViews(){systemEvent=!0,mapOptions.center=currentLoc,mapOptions.zoom=currentZoom,map=new google.maps.Map(document.getElementById("map"),mapOptions),$("#list").html(""),google.maps.event.addListener(map,"center_changed",function(e){if(!systemEvent&&0==$("div[id^=space-]").length){var t=map.getCenter();currentLoc.lat=t.G,currentLoc.lng=t.K}setTimeout(function(){systemEvent=!1},300)}),google.maps.event.addListener(map,"bounds_changed",function(){if(!systemEvent&&0==$("div[id^=space-]").length){currentZoom=map.getZoom();var e=map.getCenter();window.setTimeout(function(){loadSpaces({keepData:!0,reset:!0,location:{lat:e.lat(),lng:e.lng()}})},300),pointsInView()}setTimeout(function(){systemEvent=!1},300)})}function loadSpaces(e){var t={location:"",queryString:"",reset:!1,keepData:!1,boundToMap:!0};if($.extend(t,e),t.queryString+="&limit="+queryLimit,t.queryString+="&filters[nearest]="+userLoc.lat+","+userLoc.lng,t.boundToMap&&void 0!==map){var n=map.getBounds(),a=n.getNorthEast(),i=n.getSouthWest();t.queryString+="&filters[bounds][sw]="+i.lat()+","+i.lng(),t.queryString+="&filters[bounds][ne]="+a.lat()+","+a.lng()}t.keepData||resetViews(),spacesRequest&&4!=spacesRequest.readyState&&(console.log("abort request"),spacesRequest.abort()),spacesRequest=$.ajax(domain+"spaces.json?callback=?",{cache:!1,dataType:"json",method:"GET",data:t.queryString}).complete(function(){"function"==typeof t.callback&&t.callback()}).success(function(e){return points=t.keepData?cleanData(points.concat(e.results)):e.results,distCount=0,totalSpaceCount=e.total_count,0==points.length?(loadMap(),loadList(),!1):void(getLocation?$.each(points,function(e,n){null!==points[e].lat&&null!==points[e].lng?getDistance(userLoc,{lat:Number(points[e].lat),lng:Number(points[e].lng)},function(n){points[e].distance=n,distCount++,distCount==points.length&&(t.reset||loadSearch(),orderSpaces(),loadMap(),loadList())}):(distCount++,distCount==points.length&&(t.reset||loadSearch(),orderSpaces(),loadMap(),loadList())),points[e].link="#/space/"+points[e].id+"/"+points[e].name.replace(" ","-")}):($.each(points,function(e,t){points[e].link="#/space/"+points[e].id+"/"+points[e].name.replace(" ","-")}),t.reset||loadSearch(),orderSpaces(),loadMap(),loadList()))})}function cleanData(e){var t=[],n=[],a=[];console.log("clean data",e.sort(sortNumber),e.length);for(var i=0;i<e.length;i++)a.push(e[i].id),-1==t.indexOf(e[i].id)&&(n.push(e[i]),t.push(e[i].id));return console.log("all ids",a.sort(sortNumber),a.length),console.log("cleaned data",n.length),n}function sortNumber(e,t){return e-t}function showLoginScreen(e,t){var n=$(e),a={};$.extend(a,t),$("<div />").addClass("login-screen").html(parseTemplate("login",a)).appendTo(n),$(n.parents("div")[n.parents("div").length-1]).scrollTop(0)}function loadSearch(){$.ajax(domain+"spaces/filters.json?callback=?",{cache:!1,dataType:"json",method:"GET"}).done(function(e){$("#search").append(parseTemplate("search",e))})}function checkMarker(e,t){var n=!0;return $.each(t,function(t,a){return e[t]!=a?(n=!1,!1):void 0}),n}function findMarkers(e,t){var n={spaces:[]};return $.each(e,function(a){checkMarker(e[a],t)&&(e[a]._jsid=a,n.spaces.push(e[a]))}),n.spaces.length>1&&(n.lat=n.spaces[0].lat,n.lng=n.spaces[0].lng,""!==n.spaces[0].library?n.name=n.spaces[0].library:n.name=n.spaces[0].address),n}function loadMap(e){var t={inactiveColor:inactiveColor,activeColor:activeColor};$.extend(t,e),$.each(points,function(e){if(void 0!==points[e].marker)return!0;if(console.log("add new point"),null==points[e].lat||null==points[e].lng)return!0;"string"==$.type(points[e].lat)&&(points[e].lat=Number(points[e].lat)),"string"==$.type(points[e].lng)&&(points[e].lng=Number(points[e].lng));for(var n=findMarkers(points,{lat:points[e].lat,lng:points[e].lng}),a=n.spaces.length>1?!0:!1,i=new google.maps.Marker({position:{lat:Number(points[e].lat),lng:Number(points[e].lng)},icon:a?multiMarkerSymbol:markerSymbol,animation:google.maps.Animation.DROP}),o=0;o<n.spaces.length;o++)points[n.spaces[o]._jsid].marker=i;points[e].marker=i;var s;a?(points[e].spaces=n.spaces,points[e].template="mapMulti",s=parseTemplate("mapMulti",points[e])):(points[e].template="mapSingle",s=parseTemplate("mapSingle",points[e]));var r=new InfoBubble({content:s,shadowStyle:0,padding:0,backgroundColor:"rgba(0,0,0,0.8)",borderRadius:0,arrowSize:10,borderWidth:0,padding:12,disableAutoPan:!1,hideCloseButton:!1,backgroundClassName:"map-info-bubble",disableAnimation:!0,arrowStyle:0});points[e].mapSummary=r,i.setMap(map),google.maps.event.addListener(i,"click",function(){if(systemEvent=!0,openPoints.length>0)for(var n=0;n<openPoints.length;n++)points[openPoints[n]].mapSummary.close(),points[openPoints[n]].marker.icon.fillColor=inactiveColor,points[openPoints[n]].marker.setZIndex(0),points[openPoints[n]].marker.setMap(map),openPoints.splice(n,1);if(0==$("#bubble-"+points[e].id).length)setTimeout(function(){systemEvent=!0;var t=$("#bubble-"+points[e].id).parent();$("#bubble-"+points[e].id).remove(),t.parents(".infoBubble").css("width",.8*$("#map").width()),points[e].mapSummary.open(),$(t).append(parseTemplate(points[e].template,points[e])),t.parents(".infoBubble").css("width",.8*$("#map").width())},100);else{var a=$("#bubble-"+points[e].id).parent();a.parents(".infoBubble").css("width",.8*$("#map").width())}r.open(map,i),this.icon.fillColor=t.activeColor,this.setZIndex(100),this.setMap(map),openPoints.push(e)}),google.maps.event.addListener(r,"closeclick",function(){i.icon.fillColor=t.inactiveColor,i.setZIndex(0),i.setMap(map),openPoints=[]})}),1==openPoints.length&&(points[openPoints[0]].marker.icon.fillColor=activeColor),"function"==typeof t.callback&&t.callback()}function loadList(e){var t={inactiveColor:"rgba(0,0,0,0.6)",activeColor:"#e2637c"};return $.extend(t,e),0==points.length?($list.append($("<div />").html("There are no spaces to show with the current search criteria.").addClass("empty-list")),!0):($.each(points,function(e){if(0==$list.find("[data-id="+points[e].id+"]").length){console.log(e);var t=parseTemplate("list",points[e]);$list.append(t)}}),$(".more-spaces-link").remove(),pointsInView().length<totalSpaceCount&&$list.append($('<a href="#" class="more-spaces-link">Load more spaces</a>').on("click",function(e){if($(this).html('<i class="icon-loading"></i>'),e.preventDefault(),console.log("pages = ",Math.ceil(totalSpaceCount/queryLimit)),console.log("current page = ",Math.floor(pointsInView().length/queryLimit)),"function"==$.type(prepSearch)){var t=prepSearch();t+="&page="+Math.floor(pointsInView().length/queryLimit+1),console.log(t),loadSpaces({queryString:t,keepData:!0,reset:!0})}})),$(".list-space>h2>.library").each(function(e,t){var n=$(this).next(".address");""==$(this).html()?n.length>0&&""!==n.html()&&(n.removeClass("hidden").html(n.html().split(/\r\n|\r|\n|,/g)[0]),$(this).remove()):n.remove()}),$(".list-space").each(function(){var e=$(this).find(".description").html();$(this).hover(function(e){if(e.preventDefault(),e.stopPropagation(),!$(this).hasClass("hover")){$(this).addClass("hover");var t=findMarkers(points,{id:$(this).data("id")}).spaces[0];void 0!==t.marker&&void 0!==t.marker.icon&&(t.marker.icon.fillColor=activeColor,t.marker.setZIndex(1e4),t.marker.setMap(map))}},function(e){if(e.preventDefault(),e.stopPropagation(),$(this).hasClass("hover")){$(this).removeClass("hover");var t=findMarkers(points,{id:$(this).data("id")}).spaces[0];$(this).hasClass("clicked")||void 0!==t.marker&&void 0!==t.marker.icon&&(t.marker.icon.fillColor=inactiveColor,t.marker.setZIndex(0),t.marker.setMap(map))}}).on("click",function(e){e.preventDefault(),$this=$(this),$this.addClass("clicked"),setTimeout(function(){$this.removeClass("clicked")},400),$this.trigger("mouseout"),window.location.hash=$(this).data("link")})}),pointsInView(),void("function"==typeof t.callback&&t.callback()))}function loadTemplates(e){var t={},n=0;$.extend(t,e),$.each(templates,function(e){n++,$.ajax({url:templates[e].url,dataType:"html"}).done(function(t){templates[e].template=t,n--})});var a=setInterval(function(){"function"==typeof t.callback&&0>=n&&(clearInterval(a),t.callback())},10)}function parseTemplate(e,t,n){if(void 0==e)return!1;var a=new RegExp("(#{.*\\[.*\\].*})","g"),i,o,s,r=null,l=null,c=null,p=null;if(o=1==n?e:templates[e].template,i=o.match(a),null!==i)for(var u=0;u<i.length;u++){var a=new RegExp("(#{(.*)\\[(.*)\\](.*?)})","g"),d=a.exec(i[u]);if(null!==d&&d!==d[4]!==void 0&&(r=d[4].match(/.*limit="(.*)".*/),r=null!==r?Number(r[1]):null),null!==d&&void 0!==d[2]){var m=convertToValue(d[3],t[d[2]],{limit:r,icon:l,attr:c});o=o.replace(d[1],m)}}if(a=new RegExp("(#{(.*?)})","g"),s=o.match(a),null!==s)for(var u=0;u<s.length;u++){r=s[u].match(/.*\(.*limit="(.*)".*/),value=s[u].match(/.*\(.*value="(.*)".*/),c=s[u].match(/.*\(.*attr="(.*)".*/),l=s[u].match(/.*\(.*icon.*/),p=s[u].match(/.*\(.*raw.*/),null!==l&&(l=!0),null!==p&&(p=!0),null!==r&&(r=Number(r[1])),null!==c&&(c=c[1]),null!==value&&(value=value[1]);var h="";h=null!==r||null!==l||null!==c||null!==value||null!==p?s[u].match(/#{(.*)\(.*}/):s[u].match(/#{(.*)}/);var m=convertToValue(s[u],t[h[1]],{limit:r,icon:l,attr:c,value:value,raw:p});o=o.replace(s[u],m)}return o}function convertToValue(e,t,n){if("array"==$.type(t)){for(var a="",i=0;i<t.length;i++){var o=e;if("object"==$.type(t[i])||"array"==$.type(t[i]))o=n.raw?t[i]:parseTemplate(e,t[i],!0);else{var s=searchArray(iconMap,t[i]);-1!==s?(o=o.replace(/#{value}/g,iconMap[s][1]),o=o.replace(/#{attr}/g,iconMap[s][0].replace(/ /g,"-")),o=o.replace(/#{icon}/g,iconMap[s][2])):(o=o.replace(/#{value}/g,t[i].replace(/(.*?)/,"")),o=o.replace(/#{attr}/g,t[i]))}if(a+=o,null!==n.limit&&i>=n.limit-1)break}return a}if("object"==$.type(t)){var a=e;return n.raw?JSON.stringify(t):(null!==n.value?a=null!==n.limit?t[n.value].substr(0,n.limit):t[n.value]:$.each(t,function(e,t){a=null!==n.limit?a.replace("/#{"+e+".*}/g",String(t).substr(0,n.limit)):a.replace("/#{"+e+".*}/g",t)}),a)}if(void 0!==t&&null!==t&&"null"!==t){if(null!==n.limit&&(t=String(t).substr(0,n.limit)),null!==n.attr&&(t=String(t).replace(" ",n.attr)),n.icon){var s=searchArray(iconMap,t);-1!==s&&(t=iconMap[s][2])}return t}return""}function searchArray(e,t){for(var n=-1,a=0;a<e.length;a++)if("array"==$.type(e[a])){for(var i=0;i<e[a].length;i++)if(e[a][i]==t){n=a;break}if(-1!==n)break}else if(e[a]==t){n=a;break}return n}function getDistance(e,t,n){var a=new google.maps.DistanceMatrixService;if("array"!==$.type(e)){var i=[];i.push(e),e=i}if("array"!==$.type(t)){var i=[];i.push(t),t=i}a.getDistanceMatrix({origins:e,destinations:t,unitSystem:google.maps.UnitSystem.IMPERIAL,travelMode:google.maps.TravelMode.WALKING},function(e,t){return"OK"!=t?"":void("function"==$.type(n)&&(void 0!==e.rows[0].elements[0].distance?n(e.rows[0].elements[0].distance.text):n()))})}function loginCallback(e){"success"==e.status&&("object"==$.type(e)&&(userDetails=e),$(window).trigger("login_callback"))}function orderSpaces(){points.sort(function(e,t){return aNum=parseFloat(e.distance),bNum=parseFloat(t.distance),void 0==e.distance?1:void 0==t.distance?-1:(-1!==e.distance.indexOf("ft")&&(aNum=Number("0.0"+parseFloat(e.distance))),-1!==t.distance.indexOf("ft")&&(bNum=Number("0.0"+parseFloat(t.distance))),aNum>bNum?1:aNum<bNum?-1:0)})}function pointsInView(){for(var e=map.getBounds(),t=[],n=[new google.maps.LatLng(e.Ia.G,e.Ca.G),new google.maps.LatLng(e.Ia.j,e.Ca.G),new google.maps.LatLng(e.Ia.j,e.Ca.j),new google.maps.LatLng(e.Ia.G,e.Ca.j)],a=new google.maps.Polygon({paths:n,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:3,fillColor:"#FF0000",fillOpacity:.35}),i=0;i<points.length;i++)if(null!==points[i].lat||null!==points[i].lng){var o=new google.maps.LatLng(points[i].lat,points[i].lng),s=google.maps.geometry.poly.containsLocation(o,a);s?($list.find("[data-id="+points[i].id+"]").slideDown(300),t.push(points[i])):$list.find("[data-id="+points[i].id+"]").slideUp(300)}return t}window.Modernizr=function(e,t,n){function a(e){f.cssText=e}function i(e,t){return a(prefixes.join(e+";")+(t||""))}function o(e,t){return typeof e===t}function s(e,t){return!!~(""+e).indexOf(t)}function r(e,t){for(var a in e){var i=e[a];if(!s(i,"-")&&f[i]!==n)return"pfx"==t?i:!0}return!1}function l(e,t,a){for(var i in e){var s=t[e[i]];if(s!==n)return a===!1?e[i]:o(s,"function")?s.bind(a||t):s}return!1}function c(e,t,n){var a=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+y.join(a+" ")+a).split(" ");return o(t,"string")||o(t,"undefined")?r(i,t):(i=(e+" "+k.join(a+" ")+a).split(" "),l(i,t,n))}var p="2.8.3",u={},d=!0,m=t.documentElement,h="modernizr",g=t.createElement(h),f=g.style,v,w={}.toString,b="Webkit Moz O ms",y=b.split(" "),k=b.toLowerCase().split(" "),C={},S={},L={},M=[],V=M.slice,T,x={}.hasOwnProperty,P;P=o(x,"undefined")||o(x.call,"undefined")?function(e,t){return t in e&&o(e.constructor.prototype[t],"undefined")}:function(e,t){return x.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=V.call(arguments,1),a=function(){if(this instanceof a){var i=function(){};i.prototype=t.prototype;var o=new i,s=t.apply(o,n.concat(V.call(arguments)));return Object(s)===s?s:o}return t.apply(e,n.concat(V.call(arguments)))};return a}),C.flexbox=function(){return c("flexWrap")};for(var I in C)P(C,I)&&(T=I.toLowerCase(),u[T]=C[I](),M.push((u[T]?"":"no-")+T));return u.addTest=function(e,t){if("object"==typeof e)for(var a in e)P(e,a)&&u.addTest(a,e[a]);else{if(e=e.toLowerCase(),u[e]!==n)return u;t="function"==typeof t?t():t,"undefined"!=typeof d&&d&&(m.className+=" "+(t?"":"no-")+e),u[e]=t}return u},a(""),g=v=null,u._version=p,u._domPrefixes=k,u._cssomPrefixes=y,u.testProp=function(e){return r([e])},u.testAllProps=c,m.className=m.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(d?" js "+M.join(" "):""),u}(this,this.document);var map,$list=$("#list"),openPoints=[],loc={lat:52.205575,lng:.121682},userLoc={lat:0,lng:0},getLocation=!0,centerOnLocation=!1,points=[],listScroll=0,currView="small",currWidth=0,loginWindow,currentZoom=14,currentLoc=loc,systemEvent=!1,spacesRequest=null,totalSpaceCount=0,queryLimit=20,mapOptions={center:loc,zoom:20,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}},oldView=void 0,currViewHash=void 0,templates={list:{url:"/assets/templates/list-space.html",template:""},mapSingle:{url:"/assets/templates/map-single-space.html",template:""},mapMulti:{url:"/assets/templates/map-multi-space.html",template:""},spaceDetail:{url:"/assets/templates/space-detail.html",template:""},search:{url:"/assets/templates/search.html",template:""},addTip:{url:"/assets/templates/add-tip.html",template:""},addTag:{url:"/assets/templates/add-tag.html",template:""},spaceTip:{url:"/assets/templates/space-tip.html",template:""},login:{url:"/assets/templates/login.html",template:""}},inactiveColor="rgba(0,0,0,1)",activeColor="#00b1c1",initialView="map",view="",mapViewed=!1,markerSymbol={path:"M0-30.5c-5.7,0-10.2,4.6-10.2,10.2C-10.2-14.6,0,0,0,0s10.2-14.6,10.2-20.2C10.2-25.9,5.7-30.5,0-30.5z M0-17.7c-1.6,0-3-1.3-3-3s1.3-3,3-3s3,1.3,3,3S1.6-17.7,0-17.7z",fillColor:inactiveColor,fillOpacity:1,scale:1,strokeWeight:0},multiMarkerSymbol={path:"M0-28.5c-5.7,0-10.2,4.6-10.2,10.2C-10.2-12.6,0,0,0,0s10.2-12.6,10.2-18.2C10.2-23.9,5.7-28.5,0-28.5z M5.2-17.8h-4v4h-2.4v-4h-4v-2.4h4v-4h2.4v4h4V-17.8z",fillColor:inactiveColor,fillOpacity:1,scale:1,strokeWeight:0};$().ready(function(){resetViews(),$("html").hasClass("flexbox")||$("head").append('<link  rel="stylesheet" type="text/css" href="/assets/css/old.css" />');var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g);null!==e&&$(window).width()>1e3&&($(".view-container").each(function(){var e=$(this);e.height($(window).height()-$("#top-bar").outerHeight(!0)),"search"==e.attr("id")&&e.height($(window).height()-($("#top-bar").outerHeight(!0)+60))}),$(window).on("scroll",function(e){e.preventDefault(),$("body").stop().animate({scrollTop:0},10)})),$("#search-btn").on("click touchstart",function(e){"large"==currView&&(e.preventDefault(),$(this).hasClass("active")?($("#search").hide(0),$(this).removeClass("active")):($("#search").show(0),$(this).addClass("active")),$("div[id^=space-]").css({left:$list.offset().left,width:$list.width()}),systemEvent=!0,google.maps.event.trigger(map,"resize"))});var t=initialView;if($(window).on("hashchange",function(e){return void 0!==e.originalEvent.oldURL?oldView=e.originalEvent.oldURL.split("#")[1]:void 0!==currViewHash&&(oldView=currViewHash),console.log(oldView),currViewHash=view=window.location.hash.substr(1),"/"!=view.substr(0,1)?!1:("/"==view&&(window.location.hash="/"+initialView),view=view.substr(1),console.log("switch view - "+view),void switchView(view))}),""!==window.location.hash&&initialView!==window.location.hash){if(view=window.location.hash.substr(1),"/"!=view.substr(0,1))return!1;view=view.substr(1),t=view}loadTemplates({data:templates,callback:function(){"geolocation"in navigator&&getLocation&&0==userLoc.lat&&0==userLoc.lng?navigator.geolocation.getCurrentPosition(function(e){userLoc.lat=e.coords.latitude,userLoc.lng=e.coords.longitude,loadSpaces({location:userLoc,callback:function(){switchView(t)}})},function(){getLocation=!1,loadSpaces({location:loc,callback:function(){switchView(t)}})},{enableHighAccuracy:!1,timeout:5e3,maximumAge:0}):loadSpaces({location:loc,callback:function(){switchView(t)}})}}),moment.locale("en",{relativeTime:{future:"in %s",past:"%s",s:"seconds",m:"a minute",mm:"%d m",h:"an hour",hh:"%d h",d:"a day",dd:"%d d",M:"a month",MM:"%d m",y:"a year",yy:"%d y"}}),$(window).on("resize orientationchange",resize),$(window).trigger("resize"),$(window).on("login_success",function(e){e.preventDefault(),$(".login-screen").fadeOut(300,function(){$(this).remove()})})});